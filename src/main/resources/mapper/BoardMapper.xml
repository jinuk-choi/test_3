<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test1.project.mapper.BoardMapper">
 <!-- 게시글 목록 -->
<resultMap type="User" id="UserMap">
	<result column="u_idx" property="uIdx"/>
	<result column="u_name" property="name"/>
</resultMap>  

<resultMap type="Board" id="BoardMap">
	<result column="a_idx" property="aIdx"/>
	<result column="u_idx" property="uIdx"/>
	<result column="a_title" property="aTitle"/>
	<result column="a_content" property="aContent"/>
	<result column="a_date" property="aDate"/>
	<result column="a_count" property="aCount"/>
	<result column="a_group" property="aGroup"/>
	<result column="a_order" property="aOrder"/>
	<result column="a_depth" property="aDepth"/>
	<result column="rownum" property="rownum"/>
	<association property="user" resultMap="UserMap"/>
</resultMap> 

	<select id="selectBoardList" parameterType="Board" resultMap="BoardMap">
		SELECT         @ROWNUM := @ROWNUM - 1 AS ROWNUM,  	   		   	     	  		  	   	  
     					 ta.*, tb.u_idx, tb.u_name             
	    FROM           board ta
	    LEFT JOIN 	   user tb ON ta.u_idx = tb.u_idx,
	    			   (SELECT @rownum := (SELECT	COUNT(*)-#{pageNum}+1 FROM board ta)) tc
	     				<!--  
	    				 <if test="search != null ">
	    				 <where> 
				    	  	<if test="search.type == 1">
				    	  		a_title LIKE CONCAT('%', #{search.keyword}, '%')
				    	  	</if>
				    	  	
				    	  	<if test="search.type == 2">
				    	  		a_content LIKE CONCAT('%', #{search.keyword}, '%')
				    	  	</if>
				    	  	
				    	  	<if test="search.type == 3">
				    	  		a_content LIKE CONCAT('%', #{search.keyword}, '%')
				    	  			or a_title  LIKE CONCAT('%', #{search.keyword}, '%')
				    	  	</if>				    	
						</where>
	   				</if> -->
	      <!-- ORDER BY				a_group DESC, a_order DESC -->	  	  		   	
	    LIMIT			#{pageNum},5
	</select>
	
	<select id="selectBoardDetail" resultType="Board" resultMap="BoardMap">
		SELECT			 ta.*, tb.u_idx, tb.u_name
				             
		FROM			board ta
		LEFT JOIN       user tb ON ta.u_idx = tb.u_idx
		WHERE			a_idx =	#{aIdx}
	</select>
	
	<select id="deleteBoard" resultType="Board" parameterType="int">
		DELETE			
		FROM				board
		WHERE			a_idx = #{aIdx}
	</select>
	
	<select id="insertBoard" resultType="Board" parameterType="int">
		INSERT INTO			
		FROM				board
		WHERE			a_idx = #{aIdx}
	</select>
	
	<!-- 게시글 갯수 -->
	<select id="countBoard" resultType="int">
		SELECT COUNT(*)  count
		FROM			 board
	</select>
	
</mapper>